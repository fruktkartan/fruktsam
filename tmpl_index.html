<!doctype html>
<html lang=sv>
<head>
<meta charset=utf-8>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Historik - Fruktkartan</title>
<style>
  :root {
    --red-color: #f20505;
    --orange-color: #dd8213;
    --green-color: #53c45e;
  }

  body {
   font-family: sans;
   background-color: #fafafa;
   max-width: 34em;
 }

 .change, .flagged {
   padding: 0.5em 0 0.5em 0;
   margin: 0;
   border-top: 1px solid grey;
 }
 .change:nth-child(odd), .flagged:nth-child(odd) {
   background-color: #f8f0e3;
 }

 .flagtime, .changetime, .op, .flagname {
   font-family: monospace, monospace;
 }
 .op {
   font-weight: bold;
 }

 .separator {
   font-size: 120%;
   background-color: #cdcdcd;
   margin-top: 1em;
   margin-bottom: 1em;
 }

 .delete {
   color: var(--red-color);
 }
 .insert {
   color: var(--green-color);
 }
 .update {
   color: var(--orange-color);
 }

 .old {
   text-decoration: line-through;
   text-decoration-color: var(--red-color);
   text-decoration-thickness: 2px;
 }

 .photo img {
   border: 2px solid black;
   border-radius: 2px
 }
 .photo.added img {
   border: 4px solid var(--green-color);
   border-radius: 4px;
 }
 .photo.removed img {
   border: 4px solid var(--red-color);
   border-radius: 3px
 }

 ins, del {
   /* get rid of default underline/overstrike for these (we have colors) */
   text-decoration: none;
 }
</style>
</head>
<body>

<p>
  Sidan genererades {{ .Now }} från databas med namnet {{ .DatabaseName }}
</p>

<p>
  Det finns {{ .Trees.Count }} träd på <a href="https://fruktkartan.se/">fruktkartan.se</a>.
  Under de senaste {{ .History.SinceDays }} dagarna hände följande:
  <ul>
    <li>{{ .History.Inserts }} träd lades till</li>
    <li>{{ .History.Deletes }} träd togs bort</li>
    <li>netto {{ .History.Net }} träd</li>
    <li>{{ .History.Updates }} redigeringar gjordes</li>
  </ul>
</p>

{{ if ne .Flags.Count 0 }}
  <div class="separator">Flaggade träd</div>
{{ end }}

{{ range .Flags.Entries }}
  <p class="flagged">
    <span class="flagtime">{{ .At }}</span>
    <span class="type">
      <a href="https://fruktkartan.se/#/t/{{ .Key }}" target="_blank" rel="noopener">{{ .Tree.Type }}</a>
    </span>
    <span class="key">[{{ .Key }}]</span>
    <br/>
    <em>Flagga:</em> <span class="flagname">{{ .Flag }}</span>
    <br/>
    <span><em>Anledning:</em> {{ .Reason }}</span>
    <br/>
    <span class="desc"><em>Beskrivning:</em> {{ .Tree.Desc }}</span>
    {{ if ne .Tree.Img.String "" }}
      <br/>
      <span class="photo">
        <a href="{{ .TreeImgURL }}" target="_blank" rel="noopener"><img src="{{ .TreeImgFile }}" /></a>
      </span>
    {{ end }}
    <br/>
    <span class="lastchange"><em>Senast redigerat:</em> {{ .Tree.At }}</span>
  </p>
{{ end }}

{{ $lastDate := "" }}

{{ range .History.Entries }}
  {{ if ne $lastDate .ChangeAt.Date }}
    <div class="separator">{{ .ChangeAt.Date }}</div>
    {{ $lastDate = .ChangeAt.Date }}
  {{ end }}

  <p class="change">
    <span class="changetime">{{ .ChangeAt.TimeStr }}</span>

    {{ if eq .ChangeOp "DELETE" }}
      <span class="op delete">bort</span>
      <span class="type">{{ .Type }}</span>
      <span class="key">[{{ .Key }}]</span>
      <span>—
        <a href="{{ .Pos.OSMURL }}" target="_blank" rel="noopener">nära</a> {{ .Address }}
        <a href="{{ .Pos.GoogmapsURL }}" target="_blank" rel="noopener">(gm)</a>
      </span>
      <br/>
      <span class="desc"><span class="old"><em>Beskrivning:</em></span> {{ .Desc }}</span>
      {{ if ne .Img.String "" }}
        <br/>
        <span class="photo removed">
          <a href="{{ .ImgURL }}" target="_blank" rel="noopener"><img src="{{ .ImgFile }}" /></a>
        </span>
      {{ end }}
      <br/>
      <span class="lastchange"><em>Senast redigerat:</em> {{ .At }}</span>
    {{ end }}

    {{ if eq .ChangeOp "INSERT" }}
      <span class="op insert">nytt</span>
      <span class="type">
        <a href="https://fruktkartan.se/#/t/{{ .KeyNew }}" target="_blank" rel="noopener">{{ .TypeNew }}</a>
      </span>
      <span>—
        <a href="{{ .PosNew.OSMURL }}" target="_blank" rel="noopener">nära</a> {{ .AddressNew }}
        <a href="{{ .PosNew.GoogmapsURL }}" target="_blank" rel="noopener">(gm)</a>
      </span>
      <br/>
      <span class="desc"><em>Beskrivning:</em> {{ .DescNew }}</span>
      {{ if ne .ImgNew.String "" }}
        <br/>
        <span class="photo added">
          <a href="{{ .ImgURLNew }}" target="_blank" rel="noopener"><img src="{{ .ImgFileNew }}" /></a>
        </span>
      {{ end }}
    {{ end }}

    {{ if eq .ChangeOp "UPDATE" }}
      <span class="op update">red.</span>
      <span class="type">
        <a href="https://fruktkartan.se/#/t/{{ .KeyNew }}" target="_blank" rel="noopener">{{ .TypeNew }}</a>
      </span>
      {{ if ne .Type .TypeNew }}<span class="old">{{ .Type }}</span>{{ end }}
      <span>—
        <a href="{{ .PosNew.OSMURL }}" target="_blank" rel="noopener">nära</a> {{ .AddressNew }}
        <a href="{{ .PosNew.GoogmapsURL }}" target="_blank" rel="noopener">(gm)</a>
      </span>
      <br/>
      <span class="desc"><em>Beskrivning:</em> {{ .DescDiff }}</span>
      {{ if or (ne .Img.String "") (ne .ImgNew.String "") }}
        <br/>
      {{ end }}
      {{ if ne .Img.String "" }}
        {{ if ne .Img.String .ImgNew.String }}
          <span class="photo removed">
        {{ else }}
          <span class="photo">
        {{ end }}
          <a href="{{ .ImgURL }}" target="_blank" rel="noopener"><img src="{{ .ImgFile }}" /></a>
        </span>
      {{ end }}
      {{ if and (ne .ImgNew.String "") (ne .Img.String .ImgNew.String) }}
        <span class="photo added">
          <a href="{{ .ImgURLNew }}" target="_blank" rel="noopener"><img src="{{ .ImgFileNew }}" /></a>
        </span>
      {{ end }}
      <br/>
      <span class="lastchange"><em>Senast redigerat:</em> {{ .At }}</span>
      {{ if .UpdateIsEmpty }}<br/><span><strong>Ingen förändring, konstigt nog!</strong></span>{{ end }}
    {{ end }}
  </p>
{{ end }}

</body>
</html>
